<section class="accent-padding background-green page-header">
  <h1 class="tac text-white">Review Dashboard</h1>
</section>
<p class="tac"><%= link_to("↧", reviews_path(format: :csv), class: "btn btn-success",) %></p>

<section class="main">
  <% if @pending_reviews.count > 0 %>
    <h2 class="tac text-green">Pending Reviews</h2>
    <table class="accent-padding fw">
      <% @pending_reviews.each do | review | %>
        <tr>
          <td>
            <%= form_for(review, remote: true) do |fa| %>
              <%= fa.hidden_field :status, :value => "approved" %>
              <%= fa.submit "✔", class: "text-green decision approval ib" %>
            <% end %>
            <%= form_for(review, remote: true) do |fa| %>
              <%= fa.hidden_field :status, :value => "hidden" %>
              <%= fa.submit "✘", class: "decision denial ib" %>
            <% end %>
            <%= form_for(review, remote: true) do |fa| %>
              <%= fa.hidden_field :staff_favorite, :value => true %>
              <%= fa.submit "favorite?", class: "ib" %>
            <% end %>
          </td>
          <td><span><%= review.product.title %> | <%= review.rating %></span></td>
          <td><%= review.text %></td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <h2 class="tac text-green">No New Reviews</h1>
  <% end %>
</section>

<section class="main background-beige">
  <h2 class="tac">Staff Favorites</h2>
  <% @reviews.each do | review | %> 
  <% if review.staff_favorite == true %>
    <div class="flex-container-no">
      <div class="half">
        <h3 class="nmb"><%= review.author_first %>
         <% if review.author_last %>
            <span class="ttu"><%= review.author_last.first(1) %>.</span> 
          <% end %>
        <span class="text-green star-wrapper">
          <% review.rating.times do%>
            ★
          <% end %>
        </span>
        </h3>
        <p><%= review.text %></p>
      </div>
      <div class="half tar">
            <h3 class="text-green ttl nmb"><%= review.product.title %></h3>
        <p class="subscript nmt"><%= review.created_at.strftime('%m/%d/%Y') %></p>
        <%= form_for(review, remote: true) do |fa| %>
          <%= fa.hidden_field :staff_favorite, :value => false %>
      <%= fa.submit "unfavorite? ♥", class: "useful" %>
      <% end %>
      </div>
    </div>
    <% end %>
    <% end %>
  </section>

<section class="main">
  <h1>Latest Reviews</h1>
  <ul>
    <% @not_pending_reviews.limit(10).each do | review | %>
      <% if review.status == "denied" %>
      <div class="hidden">
      <% else %>s
      <div>
      <% end %>
      <li><b><%= review.product.title %> | <%= review.rating %> : </b> <%= review.text %></li>
    </div>
    <% end %>
  </ul>
</section> 

<script>
  $('.decision').click(function () {
    $(this).parent().parent().parent().hide();
    $('.decision-feedback').hide(); 
    if ($(this).hasClass('approval')) {
      $('.decision-feedback').removeClass('red').addClass('green').text('approved').show();
    }
    else if ($(this).hasClass('denial')) {
      $('.decision-feedback').removeClass('green').addClass('red').text('removed').show();

    }
  })
</script>
<!-- approve / deny feedback -->
<!-- seed file with approve / deny -->

